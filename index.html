<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ตารางสอน Real-time (ปรับปรุง)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Kanit -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ใช้ฟอนต์ Kanit เป็นหลัก */
        body {
            font-family: 'Kanit', sans-serif;
            background-color: #f1f5f9; /* slate-100 */
        }

        /* คอนเทนเนอร์หลักของตาราง */
        .timetable-grid {
            display: grid;
            grid-template-columns: 60px repeat(12, minmax(70px, 1fr));
            grid-template-rows: 40px repeat(7, minmax(90px, auto));
            gap: 2px;
            position: relative;
        }

        /* ปรับขนาดสำหรับจอใหญ่ (Tablet/Desktop) */
        @media (min-width: 768px) {
            .timetable-grid {
                grid-template-columns: 80px repeat(12, 1fr);
                grid-template-rows: 50px repeat(7, minmax(100px, auto));
            }
        }

        /* สไตล์หัวตาราง: เวลาและวัน */
        .grid-header {
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            font-size: 0.75rem;
            border-radius: 0.375rem;
            background-color: #e2e8f0;
            color: #475569;
        }
        @media (min-width: 768px) {
            .grid-header {
                font-size: 0.875rem;
            }
        }
        
        /* สไตล์บล็อกรายวิชา */
        .class-block {
            border-radius: 0.5rem;
            padding: 8px;
            color: white;
            font-size: 0.8rem;
            line-height: 1.3;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            animation: fadeIn 0.4s ease-out forwards;
            opacity: 0;
            transform: translateY(8px);
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .class-block:hover {
            transform: scale(1.03);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }

        .class-block.current {
            box-shadow: 0 0 15px 5px rgba(255, 223, 0, 0.7);
            transform: scale(1.05);
            z-index: 10;
            border: 2px solid #FFD700;
        }
        
        /* --- START: UPDATED REAL-TIME INDICATOR STYLES --- */

        /* Keyframes สำหรับอนิเมชันการกระพริบของวงกลม */
        @keyframes pulse {
            0% {
                transform: translateX(-50%) scale(1);
                box-shadow: 0 0 0 0 rgba(245, 130, 32, 0.7);
            }
            70% {
                transform: translateX(-50%) scale(1.1);
                box-shadow: 0 0 10px 15px rgba(245, 130, 32, 0);
            }
            100% {
                transform: translateX(-50%) scale(1);
                box-shadow: 0 0 0 0 rgba(245, 130, 32, 0);
            }
        }
        
        /* เส้นเวลาปัจจุบัน (สไตล์ใหม่) */
        #real-time-indicator {
            position: absolute;
            top: 40px; 
            bottom: 0;
            width: 4px; /* ทำให้เส้นหนาขึ้น */
            /* ใช้ Gradient สีส้มแสดของ KMITL */
            background: linear-gradient(to bottom, #F58220, #D46A1A);
            z-index: 20;
            pointer-events: none;
            transition: all 1s linear;
            box-shadow: 0 0 10px 2px #F58220; /* เพิ่มเงาเรืองแสง */
            border-radius: 2px;
        }
         @media (min-width: 768px) {
            #real-time-indicator {
                top: 50px;
            }
        }

        /* วงกลมบนเส้นเวลา (สไตล์ใหม่) */
        #real-time-indicator::before {
            content: '';
            position: absolute;
            top: -9px; /* ปรับตำแหน่งให้พอดี */
            left: 50%;
            /* transform ถูกย้ายไปใน keyframes */
            width: 18px; /* ขยายวงกลม */
            height: 18px;
            background-color: #F58220; /* สีส้ม KMITL */
            border-radius: 9999px;
            border: 3px solid white; /* ขอบขาวหนาขึ้น */
            animation: pulse 2.5s infinite; /* เพิ่มอนิเมชันการกระพริบ */
        }
        
        /* --- END: UPDATED REAL-TIME INDICATOR STYLES --- */
        
        /* Sticky Header: ทำให้หัวตารางตรึงอยู่กับที่เมื่อเลื่อน */
        .sticky-day {
            position: sticky;
            left: 0;
            z-index: 15;
        }
        .sticky-corner {
            position: sticky;
            left: 0;
            top: 0;
            z-index: 16;
            background-color: #f1f5f9;
        }
        
        /* Modal (Popup) Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        .modal-overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 500px;
            position: relative;
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        .modal-overlay.visible .modal-content {
            transform: scale(1);
        }
        .modal-close-btn {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background: #e2e8f0;
            border: none;
            border-radius: 9999px;
            width: 2rem;
            height: 2rem;
            font-size: 1.5rem;
            line-height: 1;
            cursor: pointer;
            color: #64748b;
        }
    </style>
</head>
<body class="p-4 md:p-6">

    <div class="max-w-7xl w-full mx-auto bg-white p-4 sm:p-6 lg:p-8 rounded-2xl shadow-lg border border-gray-200">
        <!-- Header -->
        <div class="text-center mb-6">
            <h1 class="text-xl sm:text-2xl lg:text-3xl font-bold text-slate-800">ตารางเรียนวิศวกรรมคอมพิวเตอร์</h1>
            <p class="text-sm sm:text-base text-slate-500">ภาคการศึกษา 1 ปีการศึกษา 2568</p>
            <p id="current-time-display" class="mt-2 text-base sm:text-lg font-semibold" style="color: #F58220;"></p>
        </div>

        <!-- Timetable Container with horizontal scroll -->
        <div class="relative overflow-x-auto shadow-inner rounded-lg bg-slate-50">
            <div id="timetable-container" class="timetable-grid">
                <!-- เนื้อหาตารางจะถูกสร้างโดย JavaScript -->
                <div id="real-time-indicator" class="hidden"></div>
            </div>
        </div>
    </div>

    <!-- Modal (Popup) HTML -->
    <div id="class-modal" class="modal-overlay">
        <div class="modal-content">
            <button id="modal-close-btn" aria-label="Close modal">&times;</button>
            <div id="modal-body" class="space-y-3">
                <!-- รายละเอียดวิชาจะถูกใส่ที่นี่โดย JavaScript -->
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- ข้อมูลตารางเรียน (เพิ่มคำอธิบายรายวิชา) ---
            const schedule = [
                 { day: 1, start: '08:00', end: '12:00', name: 'DATABASE SYSTEM', code: '01076120', section: '3(2-2)', room: 'IE 1602', instructor: 'ไม่มีข้อมูล', color: '#ef4444', description: 'ศึกษาหลักการและแนวคิดของระบบฐานข้อมูล การออกแบบ แบบจำลองข้อมูล ภาษาสอบถาม SQL และการจัดการฐานข้อมูลเบื้องต้น' },
                { day: 1, start: '13:00', end: '17:00', name: 'ANALOG DEVICES', code: '01076118', section: '3(2-2)', room: 'IE2303', instructor: 'ภาควิชาครุศาสตร์อุตสาหกรรม', color: '#f97316', description: 'ศึกษาคุณลักษณะของอุปกรณ์และวงจรอิเล็กทรอนิกส์แอนะล็อก เช่น ไดโอด, ทรานซิสเตอร์, และออปแอมป์ รวมถึงการประยุกต์ใช้งานในวงจรต่างๆ' },
                { day: 2, start: '09:00', end: '12:00', name: 'EDUCATIONAL FOUNDATION', code: '01086107', section: '3(3-0)', room: 'IE1303', instructor: 'อาคารกรมหลวงฯ', color: '#3b82f6', description: 'เรียนรู้เกี่ยวกับรากฐานและปรัชญาการศึกษา พัฒนาการของวิชาชีพครู คุณธรรมและจริยธรรมสำหรับความเป็นครู' },
                { day: 2, start: '13:00', end: '16:00', name: 'EDUCATIONAL PSYCHOLOGY', code: '01086108', section: '3(3-0)', room: 'IE1303', instructor: 'อาคารกรมหลวงฯ', color: '#2563eb', description: 'สำรวจหลักการทางจิตวิทยาที่เกี่ยวข้องกับการเรียนรู้ พัฒนาการของผู้เรียน การสร้างแรงจูงใจ และการจัดการชั้นเรียน' },
                { day: 3, start: '08:00', end: '12:00', name: 'COMPUTER SYSTEMS', code: '01076117', section: '3(2-2)', room: 'IE 3313', instructor: 'ไม่มีข้อมูล', color: '#a855f7', description: 'เรียนรู้โครงสร้างและสถาปัตยกรรมของระบบคอมพิวเตอร์ หน่วยประมวลผลกลาง หน่วยความจำ และอุปกรณ์อินพุต/เอาท์พุต' },
                { day: 3, start: '13:00', end: '17:00', name: 'SOFTWARE DESIGN & DEV', code: '01076116', section: '3(2-2)', room: 'IE 1602', instructor: 'ไม่มีข้อมูล', color: '#10b981', description: 'หลักการออกแบบและพัฒนาซอฟต์แวร์ กระบวนการทางวิศวกรรมซอฟต์แวร์ การสร้างแบบจำลอง และการประยุกต์ใช้เครื่องมือ' },
                { day: 5, start: '13:00', end: '16:00', name: 'HEALTH AND SAFETY', code: '01076019', section: '3(3-0)', room: 'IE2207', instructor: 'อาคารกรมหลวงฯ', color: '#ec4899', description: 'ความรู้เบื้องต้นเกี่ยวกับอาชีวอนามัยและความปลอดภัยในการทำงาน การประเมินความเสี่ยง และกฎหมายที่เกี่ยวข้อง' },
                { day: 0, start: '09:00', end: '12:00', name: 'ENGLISH COMMUNICATION', code: '90641008', section: '0(0-0)', room: 'Online via MS Team', instructor: 'คณะศิลปศาสตร์', color: '#84cc16', description: 'พัฒนาทักษะการสื่อสารภาษาอังกฤษทั้งการฟัง พูด อ่าน และเขียน เพื่อใช้ในชีวิตประจำวันและในเชิงวิชาการ' }
            ];


            // --- ตัวแปรและค่าคงที่ ---
            const timetableGrid = document.getElementById('timetable-container');
            const timeIndicator = document.getElementById('real-time-indicator');
            const timeDisplay = document.getElementById('current-time-display');
            const thaiDays = ['อาทิตย์', 'จันทร์', 'อังคาร', 'พุธ', 'พฤหัสบดี', 'ศุกร์', 'เสาร์'];
            const timetableStartHour = 8;
            const timetableEndHour = 20;

            // --- ฟังก์ชันสร้างตาราง ---
            const setupGrid = () => {
                timetableGrid.innerHTML = '';
                const cornerCell = document.createElement('div');
                cornerCell.className = 'sticky-corner';
                timetableGrid.appendChild(cornerCell);
                for (let i = timetableStartHour; i < timetableEndHour; i++) {
                    const timeHeader = document.createElement('div');
                    timeHeader.className = 'grid-header';
                    timeHeader.textContent = `${String(i).padStart(2, '0')}:00`;
                    timetableGrid.appendChild(timeHeader);
                }
                thaiDays.forEach((day, index) => {
                    const dayHeader = document.createElement('div');
                    dayHeader.className = 'grid-header sticky-day';
                    dayHeader.textContent = day;
                    dayHeader.style.gridRow = `${index + 2}`;
                    dayHeader.style.gridColumn = '1';
                    timetableGrid.appendChild(dayHeader);
                });
                timetableGrid.appendChild(timeIndicator);
            };

            // --- ฟังก์ชันแสดงผลรายวิชา ---
            const renderClasses = () => {
                schedule.forEach((cls, index) => {
                    const startMinutes = timeToMinutes(cls.start);
                    const endMinutes = timeToMinutes(cls.end);
                    const startCol = ((startMinutes - timetableStartHour * 60) / 60) + 2;
                    const endCol = ((endMinutes - timetableStartHour * 60) / 60) + 2;
                    const classBlock = document.createElement('div');
                    classBlock.className = 'class-block';
                    classBlock.style.backgroundColor = cls.color;
                    classBlock.style.gridRow = `${cls.day + 2}`;
                    classBlock.style.gridColumn = `${startCol} / ${endCol}`;
                    classBlock.style.animationDelay = `${index * 0.03}s`;
                    classBlock.dataset.index = index;
                    classBlock.innerHTML = `
                        <strong class="text-sm truncate">${cls.name}</strong>
                        <div class="text-xs opacity-80 mt-1">
                            <p>${cls.code}</p>
                            <p>${cls.start} - ${cls.end}</p>
                        </div>
                    `;
                    timetableGrid.appendChild(classBlock);
                });
            };
            
            // --- ฟังก์ชันอัปเดตเวลาและเส้นบอกเวลา ---
            const updateRealTime = () => {
                const now = new Date();
                const currentDay = now.getDay();
                const currentMinutes = now.getHours() * 60 + now.getMinutes();
                timeDisplay.textContent = `เวลาปัจจุบัน: ${thaiDays[currentDay]} ${now.toLocaleTimeString('th-TH')}`;
                const dayColumnWidth = window.innerWidth < 768 ? 60 : 80;
                const gridContentWidth = timetableGrid.scrollWidth - dayColumnWidth;
                const minutesSinceStart = currentMinutes - (timetableStartHour * 60);
                const totalMinutesInView = (timetableEndHour - timetableStartHour) * 60;
                if (minutesSinceStart >= 0 && minutesSinceStart < totalMinutesInView) {
                    const percentage = (minutesSinceStart / totalMinutesInView) * 100;
                    timeIndicator.style.left = `calc(${dayColumnWidth}px + ${percentage/100 * gridContentWidth}px)`;
                    timeIndicator.style.gridRow = `${currentDay + 2}`;
                    timeIndicator.classList.remove('hidden');
                } else {
                    timeIndicator.classList.add('hidden');
                }
                document.querySelectorAll('.class-block').forEach(block => {
                    const cls = schedule[parseInt(block.dataset.index)];
                    if (cls.day === currentDay && currentMinutes >= timeToMinutes(cls.start) && currentMinutes < timeToMinutes(cls.end)) {
                        block.classList.add('current');
                    } else {
                        block.classList.remove('current');
                    }
                });
            };

            // --- ฟังก์ชันจัดการ Modal (Popup) ---
            const modal = document.getElementById('class-modal');
            const modalBody = document.getElementById('modal-body');
            const modalCloseBtn = document.getElementById('modal-close-btn');

            const openModal = (cls) => {
                modalBody.innerHTML = `
                    <h3 class="text-xl font-bold" style="color:${cls.color};">${cls.name}</h3>
                    <div class="border-t border-slate-200 my-3"></div>
                    <p><strong class="text-slate-600 w-28 inline-block">รหัสวิชา:</strong> ${cls.code}</p>
                    <p><strong class="text-slate-600 w-28 inline-block">หน่วยกิต (กลุ่ม):</strong> ${cls.section}</p>
                    <p><strong class="text-slate-600 w-28 inline-block">อาจารย์ผู้สอน:</strong> ${cls.instructor}</p>
                    <p><strong class="text-slate-600 w-28 inline-block">เวลา:</strong> ${cls.start} - ${cls.end}</p>
                    <p><strong class="text-slate-600 w-28 inline-block">วัน:</strong> ${thaiDays[cls.day]}</p>
                    <p><strong class="text-slate-600 w-28 inline-block">ห้องเรียน:</strong> ${cls.room}</p>
                    <div class="border-t border-slate-200 my-3"></div>
                    <div>
                        <strong class="text-slate-600">คำอธิบายรายวิชา:</strong>
                        <p class="text-slate-500 mt-1 text-sm">${cls.description}</p>
                    </div>
                `;
                modal.classList.add('visible');
            };
            const closeModal = () => modal.classList.remove('visible');

            // --- Event Listeners ---
            timetableGrid.addEventListener('click', (e) => {
                const classBlock = e.target.closest('.class-block');
                if (classBlock) {
                    const index = parseInt(classBlock.dataset.index);
                    openModal(schedule[index]);
                }
            });
            modalCloseBtn.addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeModal();
            });

            // --- ฟังก์ชันช่วย ---
            const timeToMinutes = (timeStr) => {
                const [hours, minutes] = timeStr.split(':').map(Number);
                return hours * 60 + minutes;
            };

            // --- เริ่มการทำงาน ---
            setupGrid();
            renderClasses();
            updateRealTime();
            setInterval(updateRealTime, 1000);
            window.addEventListener('resize', () => {
                setupGrid();
                renderClasses();
                updateRealTime();
            });
        });
    </script>
</body>
</html>
